{
    "version": "7.2.6a-172322",
    "description": "Powerful x86 and AMD64/Intel64 virtualization product for enterprise as well as home use.",
    "homepage": "https://www.virtualbox.org",
    "license": {
        "identifier": "GPL-3.0-only",
        "url": "https://www.virtualbox.org/wiki/Licensing_FAQ"
    },
    "notes": "Guest Additions are located at: \"$env:ProgramW6432\\Oracle\\VirtualBox\\VBoxGuestAdditions.iso\".",
    "depends": "extras/vcredist2022",
    "url": "https://download.virtualbox.org/virtualbox/7.2.6/VirtualBox-7.2.6a-172322-Win.exe",
    "hash": "15c18780b9a76ff6d5a2dbfe016992e0aea631bf25ffc05a11080bb0ed49a690",
    "architecture": {
        "64bit": {
            "pre_install": "if (-not (is_admin)) { abort \"`n[ERROR]  $app requires admin rights to $cmd.\" }"
        },
        "arm64": {
            "pre_install": "if (-not (is_admin)) { abort \"`n[ERROR]  $app requires admin rights to $cmd.\" }"
        }
    },
    "installer": {
        "script": [
            "$extract_params = @('-extract', '-path', \"$dir\\tmp\", '-silent')",
            "$extract_status = Invoke-ExternalCommand -FilePath \"$dir\\$fname\" -ArgumentList $extract_params -Quiet",
            "if (-not $extract_status) { abort \"`nExtraction Failed: Unable to unpack '$dir\\$fname'.\" }",
            "$installer_regex = if ($architecture -eq 'arm64') { 'arm' } else { '^(?!.+arm)' }",
            "$installer_file = Get-ChildItem -Path \"$dir\\tmp\" -Filter '*.msi' -File |",
            "        Where-Object { $_.BaseName -match $installer_regex } | Select-Object -ExpandProperty FullName -First 1",
            "if (-not $installer_file) { abort \"`nDeployment Failed: MSI package not found in extraction buffer.\" }",
            "$install_args = @(",
            "    '/i', $installer_file, '/qn', '/norestart'",
            "    'VBOX_START=0', 'VBOX_INSTALLDESKTOPSHORTCUT=0', 'VBOX_INSTALLQUICKLAUNCHSHORTCUT=0', 'VBOX_INSTALLSTARTMENUENTRIES=0'",
            ")",
            "$deploy_status = Invoke-ExternalCommand -FilePath 'msiexec.exe' -ArgumentList $install_args -LogPath \"$dir\\tmp\\install.log\"",
            "if (-not $deploy_status) {",
            "    Select-String -Path \"$dir\\tmp\\install.log\" -Pattern 'MSI\\s*\\(.*' | ForEach-Object { warn \"Log Trace: $($_.Line)\" }",
            "    abort \"Installation Failed: Exit code indicates a deployment failure.`nReference Log: '$dir\\tmp\\install.log'.\"",
            "}",
            "Remove-Item -Path \"$dir\\tmp\", \"$dir\\$fname\" -Recurse -Force -ErrorAction SilentlyContinue"
        ]
    },
    "post_install": [
        "$install_dir = \"$env:ProgramW6432\\Oracle\\VirtualBox\"",
        "if (-not (Test-Path -Path \"$install_dir\\*\")) { abort \"`nInstallation Failed: The directory '$install_dir' is missing or empty.\" }",
        "Get-ChildItem -Path $install_dir -Filter '*.exe' -File | ForEach-Object {",
        "   Write-Output \"Creating shim '$($_.BaseName)'.\"",
        "   shim $_.FullName $global $_.BaseName $null",
        "}",
        "startmenu_shortcut \"$install_dir\\VirtualBox.exe\" 'VirtualBox' $null $null $global"
    ],
    "pre_uninstall": "if (-not (is_admin)) { abort \"`n[ERROR] $app requires admin rights to $cmd\" }",
    "uninstaller": {
        "script": [
            "Get-ChildItem -Path \"$env:ProgramW6432\\Oracle\\VirtualBox\" -Filter '*.exe' -File | ForEach-Object {",
            "    rm_shim $_.BaseName \"$(shimdir $global)\"",
            "}",
            "$registry_path = 'HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*'",
            "$product_id = Get-ItemProperty -Path $registry_path | Where-Object { $_.DisplayName -like '*Oracle VirtualBox*' } |",
            "        Select-Object -ExpandProperty PSChildName -First 1",
            "if (-not $product_id) { abort \"Uninstallation Failed: Could not locate the product identity for Oracle VirtualBox.\" }",
            "$removal_args = @('/x', $product_id, '/qn', '/norestart')",
            "$removal_status = Invoke-ExternalCommand -FilePath 'msiexec.exe' -ArgumentList $removal_args -LogPath \"$dir\\uninstall.log\"",
            "if(-not $removal_status) { abort \"Uninstallation Failed: Process did not complete.`nReference Log: '$dir\\uninstall.log'.\" }",
            "Remove-Item -Path \"$dir\\*.log\" -Force -ErrorAction SilentlyContinue"
        ]
    },
    "post_uninstall": [
        "$shortcut_file = Get-AbsolutePath -Path \"$(shortcut_folder $global)\\VirtualBox.lnk\"",
        "Write-Output \"`nRemoving shortcut '$(friendly_path $shortcut_file)'...\"",
        "Remove-Item -LiteralPath $shortcut_file -Force -ErrorAction SilentlyContinue"
    ],
    "checkver": {
        "url": "https://www.virtualbox.org/wiki/Downloads",
        "regex": "VirtualBox-([\\w.-]+)-Win.exe"
    },
    "autoupdate": {
        "url": "https://download.virtualbox.org/virtualbox/$matchHead/VirtualBox-$version-Win.exe",
        "hash": {
            "url": "https://download.virtualbox.org/virtualbox/$matchHead/SHA256SUMS"
        }
    }
}
