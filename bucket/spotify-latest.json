{
    "version": "1.1.30.658.gf13cde74",
    "description": "Digital music service.",
    "homepage": "https://www.spotify.com/",
    "license": {
        "identifier": "Freeware",
        "url": "https://www.spotify.com/au/legal/end-user-agreement/"
    },
    "url": "https://download.spotify.com/SpotifyFullSetup.exe",
    "hash": "77c953863c5882ba78796c192044cbea3841dbdab02a4b2b9237793991e17285",
    "installer": {
        "script": [
            "if (Test-Path \"$(appdir spotify-blockthespot)\") {",
            "    Write-Host \"$app and spotify-blockthespot cannot both be installed at the same time.\" -Foreground Red",
            "    exit 1",
            "}",
            "",
            "Stop-Process -ErrorAction Ignore -Name Spotify | Out-Null",
            "Start-Process -Wait \"$dir\\SpotifyFullSetup.exe\" -ArgumentList '/extract', \"$dir\"",
            "Remove-Item \"$dir\\SpotifyFullSetup.exe\"",
            "",
            "icacls \"$env:LOCALAPPDATA\\Spotify\\Update\" /reset /T | Out-Null",
            "Remove-Item -ErrorAction Ignore -Recurse \"$env:LOCALAPPDATA\\Spotify\\Update\" | Out-Null",
            "New-Item -ErrorAction Ignore \"$env:LOCALAPPDATA\\Spotify\\Update\" -ItemType Directory | Out-Null",
            "icacls \"$env:LOCALAPPDATA\\Spotify\\Update\" /deny Everyone:R | Out-Null",
            "",
            "New-Item \"$dir\\config.ini\" # Persist for BlockTheSpot"
        ]
    },
    "post_install": [
        "if (Test-Path \"$(appdir spicetify-cli)\") {",
        "    spicetify config spotify_path \"$(Split-Path $(scoop which Spotify))\" --quiet",
        "    spicetify restore backup apply --quiet --no-restart",
        "}",
        "",
        "$blockthespot_path = \"$(appdir blockthespot)\\current\"",
        "",
        "if (Test-Path \"$blockthespot_path\") {",
        "    Move-Item -Force \"$dir\\chrome_elf.dll\" -Destination \"$dir\\chrome_elf.dll.original\"",
        "    Copy-Item \"$blockthespot_path\\chrome_elf.dll\" -Destination \"$dir\"",
        "    if (-not (Get-Content -ErrorAction Ignore \"$dir\\config.ini\")) { Copy-Item \"$blockthespot_path\\config.ini\" -Destination \"$dir\" }",
        "}"
    ],
    "uninstaller": {
        "script": [
            "Stop-Process -ErrorAction Ignore -Name Spotify | Out-Null",
            "Move-Item -ErrorAction Ignore -Force \"$env:APPDATA\\Spotify\" -Destination \"$env:APPDATA\\Spotify.original\" | Out-Null",
            "Start-Process -Wait \"$dir\\Spotify.exe\" -ArgumentList '/Uninstall', '/Silent'",
            "Move-Item -ErrorAction Ignore -Force \"$env:APPDATA\\Spotify.original\" -Destination \"$env:APPDATA\\Spotify\" | Out-Null",
            "icacls \"$env:LOCALAPPDATA\\Spotify\\Update\" /grant Everyone:R | Out-Null"
        ]
    },
    "bin": "Spotify.exe",
    "shortcuts": [
        [
            "Spotify.exe",
            "Spotify"
        ]
    ],
    "persist": "config.ini",
    "checkver_": {
        "script": [
            "Invoke-WebRequest https://download.spotify.com/SpotifyFullSetup.exe -OutFile \"SpotifyFullSetup.exe\"",
            "$version = Get-ChildItem SpotifyFullSetup.exe | ForEach-Object { $_.VersionInfo.ProductVersion }",
            "Remove-Item \"SpotifyFullSetup.exe\"",
            "return \"$version\""
        ],
        "regex": "(.+)"
    },
    "autoupdate": {
        "url": "https://download.spotify.com/SpotifyFullSetup.exe"
    }
}
