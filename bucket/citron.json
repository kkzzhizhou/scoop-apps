{
  "version": "8701839b1",
  "description": "Nintendo Switch Emulator",
  "homepage": "https://github.com/Zephyron-Dev/Citron-CI",
  "license": "GPL-3.0",
  "architecture": {
    "64bit": {
      "url": "https://github.com/Zephyron-Dev/Citron-CI/releases/download/nightly-windows/Citron-windows-nightly-8701839b1-x64.zip",
      "hash": "5943d300a7fe2d2e7542310e236a97be58da6032704fe19d064625ec4ce09836"
    }
  },
  "pre_install": [
    "",
    "# Ensure user folder exists",
    "if (-not (Test-Path \"$dir\\user\")) {",
    "New-Item -ItemType Directory -Path \"$dir\\user\" -Force | Out-Null",
    "}",
    "$appDataPath = $env:APPDATA",
    "$documentsPath = [Environment]::GetFolderPath('MyDocuments')",
    "",
    "# Migrate application data from common locations",
    "$appDataPath, $documentsPath | ForEach-Object {",
    "$path = if ($_ -eq $appDataPath) { \"$appDataPath\\citron\" } else { \"$documentsPath\\citron\" }",
    "if (Test-Path $path) {",
    "$items = Get-ChildItem -Path $path -Force",
    "if ($items) {",
    "Write-Host \"Migrating data from $path\"",
    "$items | Copy-Item -Destination \"$dir\\portable_data\" -Recurse -Force -ErrorAction SilentlyContinue",
    "}",
    "}",
    "}"
  ],
  "bin": "citron.exe",
  "shortcuts": [
    [
      "citron.exe",
      "Nintendo Switch [switch][citron]"
    ]
  ],
  "persist": "user",
  "checkver": {
    "regex": "^citron:\\s*(?<commit>[a-f0-9]{7,40})",
    "replace": "${commit}",
    "script": [
      "# Emit version as 'citron: <shortsha>' by extracting the commit from the nightly release title",
      "$app = 'citron'",
      "$api = 'https://api.github.com/repos/Zephyron-Dev/Citron-CI/releases/tags/nightly-windows'",
      "$hdr = @{ 'User-Agent' = 'Mozilla/5.0' }",
      "try { $rel = Invoke-RestMethod -Uri $api -Headers $hdr -UseBasicParsing -ErrorAction Stop } catch { Write-Error 'api-failed'; exit 1 }",
      "# Expect release name like: 'Windows Nightly: 8701839b1'",
      "if ($rel.name -and ($rel.name -match 'Windows\\s+Nightly:\\s*([a-f0-9]{7,40})')) { Write-Output ($app + ': ' + $matches[1]); exit 0 }",
      "# Fallback: try any hex blob in the release name/tag/assets",
      "$sha = $null",
      "if ($rel.name -and ($rel.name -match '([a-f0-9]{7,40})')) { $sha = $matches[1] }",
      "if (-not $sha -and $rel.tag_name -and ($rel.tag_name -match '([a-f0-9]{7,40})')) { $sha = $matches[1] }",
      "if (-not $sha -and $rel.assets -and $rel.assets.Count -gt 0) { foreach ($a in $rel.assets) { if ($a.name -match '([a-f0-9]{7,40})') { $sha = $matches[1]; break } } }",
      "if ($sha) { Write-Output ($app + ': ' + $sha); exit 0 }",
      "Write-Error 'could not parse nightly-windows release for commit'"
    ]
  },
  "autoupdate": {
    "architecture": {
      "64bit": {
        "url": "https://github.com/Zephyron-Dev/Citron-CI/releases/download/nightly-windows/Citron-windows-nightly-$matchCommit-x64.zip"
      }
    }
  }
}
