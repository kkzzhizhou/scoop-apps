{
    "version": "5.22.150.1014",
    "description": "Android emulator",
    "homepage": "https://www.bluestacks.com/bluestacks-5.html",
    "license": {
        "identifier": "Freeware",
        "url": "https://www.bluestacks.com/terms-and-privacy.html#terms"
    },
    "architecture": {
        "64bit": {
            "url": "https://ak-build.bluestacks.com/public/app-player/windows/nxt/5.22.150.1014/c6b85b9680fe708a143d721bdc7dd4e3/FullInstaller/x64/BlueStacksFullInstaller_5.22.150.1014_amd64_native.exe#/setup.exe",
            "hash": "5ad80b2b1d63095d593d81f364247cbd14b2b1acd266218b62303388375e5da7"
        }
    },
    "installer": {
        "script": [
            "if (!(is_admin)) { \"$app requires admin rights to $cmd\"; break }",
            "Start-Process -Wait \"$dir\\setup.exe\" \"-s\" -Verb RunAs",
            "Remove-Item \"$Env:Public\\Desktop\\BlueStacks 5*.lnk\""
        ]
    },
    "uninstaller": {
        "script": [
            "if (!(is_admin)) { \"$app requires admin rights to $cmd\"; break }",
            "$uninstaller = (Get-ItemProperty -ErrorAction Ignore \"HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\BlueStacks_nxt\" -Name UninstallString).UninstallString",
            "if (!$uninstaller) { $uninstaller = (Get-ItemProperty -ErrorAction Ignore \"HKLM:\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\BlueStacks_nxt\" -Name UninstallString).UninstallString }",
            "if (!$uninstaller) { warn 'Could not find app info in registry' }",
            "# Remove -tmp at the end",
            "$uninstaller = $uninstaller.Substring(0, $uninstaller.Length - 5)",
            "Start-Process -Wait \"$uninstaller\" \"-s\" -Verb RunAs"
        ]
    },
    "checkver": {
        "script": [
            "$first_letter, $publisher, $package = 'b', 'BlueStack', 'BlueStacks'",
            "$manifests_root = 'https://api.github.com/repositories/197275551/contents/manifests'",
            "$package_url = '{0}/{1}/{2}/{3}' -f $manifests_root, $first_letter, $publisher, $package",
            "$response = Invoke-RestMethod -Uri $package_url -Method Get -ErrorAction Stop",
            "$path_segments = $response | Where-Object { $_.type -eq 'dir' } |",
            "        Sort-Object -Property { [version]$_.name } -Descending | ForEach-Object -MemberName name",
            "foreach ($path_segment in $path_segments) {",
            "    $manifest_url = '{0}/{1}/{2}/{3}/{4}/{2}.{3}.installer.yaml' -f $manifests_root, $first_letter, $publisher, $package, $path_segment",
            "    $manifest_info = Invoke-RestMethod -Uri $manifest_url -Headers @{ 'Accept' = 'application/vnd.github.v3.raw' } -ErrorAction Stop",
            "    if ($null -ne $manifest_info -and $manifest_info -match 'nxt/(?<version>[\\d.]+)/(?<token>[^/]+)') {",
            "        Write-Output \"$($Matches['version']), $($Matches['token'])\"",
            "        break",
            "    }",
            "}"
        ],
        "regex": "([\\d.]+), (?<token>.+)"
    },
    "autoupdate": {
        "architecture": {
            "64bit": {
                "url": "https://ak-build.bluestacks.com/public/app-player/windows/nxt/$version/$matchToken/FullInstaller/x64/BlueStacksFullInstaller_$version_amd64_native.exe#/setup.exe"
            }
        },
        "hash": {
            "url": "https://raw.githubusercontent.com/microsoft/winget-pkgs/HEAD/manifests/b/BlueStack/BlueStacks/$version/BlueStack.BlueStacks.installer.yaml",
            "regex": "(?s)$basename.+?$sha256"
        }
    }
}
